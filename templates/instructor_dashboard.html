{% extends "base.html" %}
{% block content %}

<div class="container mt-5">

    <!-- Title -->
    <h2 class="text-white mb-4 fw-bold">Instructor Dashboard</h2>

    <!-- Summary Cards -->
    <div class="row mb-4 g-4">

        <div class="col-md-2">
            <div class="card text-center shadow rounded-4 bg-primary text-white p-3">
                <h6>Total</h6>
                <h2>{{ total }}</h2>
            </div>
        </div>

        <div class="col-md-2">
            <div class="card text-center shadow rounded-4 bg-success text-white p-3">
                <h6>Graded</h6>
                <h2>{{ graded }}</h2>
            </div>
        </div>

        <div class="col-md-2">
            <div class="card text-center shadow rounded-4 bg-warning text-dark p-3">
                <h6>Pending</h6>
                <h2>{{ pending }}</h2>
            </div>
        </div>

        <div class="col-md-2">
            <div class="card text-center shadow rounded-4 bg-danger text-white p-3">
                <h6>Late</h6>
                <h2>{{ late }}</h2>
            </div>
        </div>

        <div class="col-md-2">
            <div class="card text-center shadow rounded-4 bg-dark text-white p-3">
                <h6>Rejected</h6>
                <h2>
                    {{ submissions | selectattr("status","equalto","Rejected") | list | length }}
                </h2>
            </div>
        </div>

    </div>

    <!-- Submissions Table -->
    <div class="card shadow-lg rounded-4 p-4">
        <h4 class="mb-3">All Submissions</h4>

        <div class="table-responsive">
            <table class="table table-hover align-middle">

                <thead class="table-light">
                    <tr>
                        <th>Student</th>
                        <th>Assignment</th>
                        <th>Status</th>
                        <th>Grade</th>
                        <th>Submitted At</th>
                        <th>Action</th>
                    </tr>
                </thead>

                <tbody>
                    {% for s in submissions %}
                    <tr>
                        <td>{{ s.student }}</td>
                        <td>{{ s.assignment }}</td>

                        <!-- Status Badge -->
                        <td>
                            {% if s.status == "Submitted" %}
                                <span class="badge bg-warning text-dark">Pending</span>
                            {% elif s.status == "Late" %}
                                <span class="badge bg-danger">Late</span>
                            {% elif s.status == "Graded" %}
                                <span class="badge bg-success">Graded</span>
                            {% elif s.status == "Rejected" %}
                                <span class="badge bg-dark">Rejected</span>
                            {% endif %}
                        </td>

                        <td>
                            {{ s.grade if s.grade is not none else "-" }}
                        </td>

                        <td>
                            {{ s.submitted_at.strftime('%d %b %Y %H:%M') }}
                        </td>

                        <!-- Action Buttons -->
                        <td>

                            {% if s.status == "Submitted" or s.status == "Late" %}
                                <a href="{{ url_for('grade_submission', index=loop.index0) }}"
                                   class="btn btn-primary btn-sm mb-1">
                                    Grade
                                </a>
                            {% endif %}

                            {% if s.status == "Graded" or s.status == "Rejected" %}
                                <a href="{{ url_for('reopen_submission', index=loop.index0) }}"
                                   class="btn btn-warning btn-sm mb-1">
                                    Reopen
                                </a>
                            {% endif %}

                            <a href="{{ url_for('delete_submission', index=loop.index0) }}"
                               class="btn btn-danger btn-sm mb-1"
                               onclick="return confirm('Are you sure you want to delete this submission?')">
                                Delete
                            </a>

                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center text-muted">
                            No submissions available
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>

            </table>
        </div>
    </div>

    <!-- Report Button -->
    <div class="mt-4">
        <a href="{{ url_for('report') }}"
           class="btn btn-outline-light rounded-pill px-4">
            View Report & Analysis
        </a>
    </div>

</div>

{% endblock %}